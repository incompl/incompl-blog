<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>__proto__ is not constructor.prototype</title>
    <link rel="icon" type="image/png" href="http://incompl.com/images/favicon.png"/>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/code.css">
  </head>

  <body>
    <div id="wrapper">
      <span class="author">
        October 20, 2011
      </span>
      <h1><a href="/">incompl</a></h1>
      <h2>__proto__ is not constructor.prototype</h2>
      <div class="post">
        <div class="entrybody">
          JavaScript's <a href="https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Object/Proto">__proto__</a> property is extremely handy but non-standard and deprecated. I've seen a lot of people around the net saying that constructor.prototype can be used as an alternative to __proto__. At first they seem to be the same:
<div class="highlight"><pre><code class="javascript"><span class="kd">function</span> <span class="nx">Foo</span><span class="p">()</span> <span class="p">{}</span>
<span class="kd">var</span> <span class="nx">foo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Foo</span><span class="p">();</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">foo</span><span class="p">.</span><span class="nx">__proto__</span> <span class="o">==</span> <span class="nx">Foo</span><span class="p">.</span><span class="nx">prototype</span><span class="p">);</span> <span class="c1">// true</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">foo</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">==</span> <span class="nx">Foo</span><span class="p">.</span><span class="nx">prototype</span><span class="p">);</span> <span class="err">Â </span><span class="c1">// true</span>
</code></pre>
</div>

Unfortunately when you really start to dig in you find that they're not equivalent:
<div class="highlight"><pre><code class="javascript"><span class="kd">function</span> <span class="nx">Parent</span><span class="p">()</span> <span class="p">{}</span>
<span class="kd">var</span> <span class="nx">parent</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Parent</span><span class="p">();</span>
<span class="kd">function</span> <span class="nx">Child</span><span class="p">()</span> <span class="p">{}</span>
<span class="nx">Child</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="nx">parent</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">child</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Child</span><span class="p">();</span>

<span class="c1">// child inherits directly from parent. this makes sense.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">child</span><span class="p">.</span><span class="nx">__proto__</span> <span class="o">===</span> <span class="nx">parent</span><span class="p">);</span> <span class="c1">// true</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">child</span><span class="p">.</span><span class="nx">__proto__</span> <span class="o">===</span> <span class="nx">Parent</span><span class="p">.</span><span class="nx">prototype</span><span class="p">);</span> <span class="c1">// false</span>

<span class="c1">// you might think child&#39;s constructor would be Child, but it&#39;s Parent.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">child</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">===</span> <span class="nx">Parent</span><span class="p">);</span> <span class="c1">// true</span>

<span class="c1">// as a result, you get this</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">child</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">===</span> <span class="nx">parent</span><span class="p">);</span> <span class="c1">// false</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">child</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">===</span> <span class="nx">Parent</span><span class="p">.</span><span class="nx">prototype</span><span class="p">);</span> <span class="c1">// true</span>
</code></pre>
</div>

<p>
This has become especially relevant lately with the introduction of __proto__'s weaker successor, <a href="https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Object/GetPrototypeOf">getPrototypeOf</a>. It does what __proto__ does, but it's read-only, while setting the __proto__ property of an object is one of __proto's__ handy little charms.
</p><p>
Since not everyone supports getPrototypeOf yet, polyfills have been <a href="https://gist.github.com/1052392">popping</a> <a href="https://gist.github.com/1022883">up</a> around the net that fall back to __proto__ and constructor.prototype. However, these polyfills are broken, because constructor.prototype just isn't the same thing. Adding to the confusion, <a href="http://ejohn.org/blog/objectgetprototypeof/">John Resig's post</a> on getPrototypeOf insinuates that they're the same thing as well.
</p><p>
I'm glad that we're getting a standard way to access an object's prototype with getPrototypeOf. It's unfortunate all the polyfills I've seen aren't correct and I can't think of a way to polyfill below IE9. Anyone have any clever ideas?
</p>
        </div>
      </div>
    </div>
  </body>
</html>